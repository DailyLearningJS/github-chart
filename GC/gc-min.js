var GC;GC=function(){function t(t){if(t){var e=this.createSection(t);switch(this.dataBase=this.getPerDay(t),e){case"bar":this.createBar();break;case"pie":this.createPie()}}}return t.prototype.createSection=function(t){function e(t){switch(t){case"normal":$(".wrp-normal").removeClass("hidden"),$(".wrp-bar").addClass("hidden"),$(".wrp-pie").addClass("hidden");break;case"bar":$(".wrp-bar").removeClass("hidden"),$(".wrp-normal").addClass("hidden"),$(".wrp-pie").addClass("hidden"),0===$(".js-calendar-d-svg").length&&l.createBar();break;case"pie":$(".wrp-pie").removeClass("hidden"),$(".wrp-bar").addClass("hidden"),$(".wrp-normal").addClass("hidden"),0===$(".js-calendar-m-svg").length&&l.createPie()}}var a="",l=this,n="<div class='btn-toggle'><a href='#' class='tooltipped tooltipped-nw btn-toggle-btn btn-normal' data-target='normal' aria-label='Normal chart view'><i></i></a><a href='#' class='tooltipped tooltipped-nw btn-toggle-btn btn-bar' data-target='bar' aria-label='GC Bar chart view'><i></i></a><a href='#' class='tooltipped tooltipped-nw btn-toggle-btn btn-pie' data-target='pie' aria-label='GC Pie chart view'><i></i></a></div>";$(t).siblings("h3").before($(n));var s="<div class='gc-wrapper wrp-bar'></div><div class='gc-wrapper wrp-pie'></div>";return $(t).prepend($(s)),$(t).find(".js-calendar-graph, .contrib-footer, .contrib-column").addClass("wrp-normal"),chrome.storage.local.get("gcToggleSetting",function(t){var a=t.gcToggleSetting?t.gcToggleSetting:"normal";$(".btn-"+a).addClass("active"),e(a)}),$(".btn-toggle").on("click",".btn-toggle-btn",function(t){t.preventDefault(),$(this).siblings().removeClass("active"),$(this).addClass("active");var a=$(this).data("target");e(a),chrome.storage.local.set({gcToggleSetting:a})}),a},t.prototype.getPerDay=function(t){for(var e,a,l,n=$(t).find("rect.day"),s={day:[]},r={count:0},o={count:0},i={},c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=0,g=n.length;g>d;d++)e=$(n[d]),a=e.data("date"),l=e.data("count"),m=a.split("-")[1],i[m]=i[m]?i[m]+l:l,s.day.push({date:a,count:l}),l>r.count&&(r.date=a,r.count=l);for(var d in i)i[d]>o.count&&(o.count=i[d],o.date=d);o.date=c[parseInt(o.date)-1];var h=$(".contrib-column"),x=$(h[0]).find("span.contrib-number").html(),y=$(h[0]).find("span:last-child").html(),p=$(h[1]).find("span.contrib-number").html(),u=$(h[1]).find("span:last-child").html(),b=$(h[2]).find("span.contrib-number").html(),f=$(h[2]).find("span:last-child").html();return s.info={ciTotal:x.split(" ")[0],ciDate:y,longestStreak:p.split(" ")[0],longestDate:u,currentStreak:b.split(" ")[0],currentDate:f,bestDay:r,bestMonth:o},s},t.prototype.createPie=function(){for(var t,e,a=this.dataBase.day,l=(this.dataBase.info.ciTotal,new Date(a[0].date)),n=l.getDay(),s=[],r=[{angle:52},{angle:51},{angle:51},{angle:52},{angle:51},{angle:51},{angle:52}],o={count:0},i=["#97b552","#2ec7c9","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d"],c=["Sunday","Monday","Tuesday","Wednesday","Thurday","Friday","Saturday"],d={},g={},h={},x=0,y=0,p=a.length;p>y;y++)s[n]=s[n]?s[n]+a[y].count:a[y].count,n=(n+1)%7;for(var y=0;7>y;y++)void 0!==s[y]?s[y]>o.count&&(o.count=s[y],o.name=y):s[y]=0;for(var y=0;7>y;y++)t=s[y]/o.count*115,e=i[y],d.x=120+Math.sin(x/180*Math.PI)*t,d.y=120-Math.cos(x/180*Math.PI)*t,x+=r[y].angle,g.x=120+Math.sin(x/180*Math.PI)*t,g.y=120-Math.cos(x/180*Math.PI)*t,h.angle=(x-26)/180*Math.PI,h.x1=120+Math.sin(h.angle)*t,h.y1=120-Math.cos(h.angle)*t,h.x2=120+135*Math.sin(h.angle),h.y2=120-140*Math.cos(h.angle),h.angle>Math.PI?(h.x3=h.x2-20,h.align="end"):(h.x3=h.x2+20,h.align="start"),h.y3=h.y2,r[y]={start:{x:d.x,y:d.y},end:{x:g.x,y:g.y},radius:t,fill:e,pol:{x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2,x3:h.x3,y3:h.y3,align:h.align}};$(".wrp-pie").append($("<svg width='728' height='340' class='js-calendar-m-svg'></svg>"));var u=[];u.push('<g transform="translate(70, 50)">','<circle cx="120" cy="120" r="120" stroke="#bbb" stroke-width="1" fill="white" />');for(var y=0;7>y;y++)u.push('<path d="M120 120,L',r[y].start.x," ",r[y].start.y," A",r[y].radius," ",r[y].radius," 0 0 1 ",r[y].end.x," ",r[y].end.y,' Z" fill="',r[y].fill,'" />','<polyline points="',r[y].pol.x1,",",r[y].pol.y1," ",r[y].pol.x2,",",r[y].pol.y2," ",r[y].pol.x3,",",r[y].pol.y3,'" style="fill:transparent;stroke:',r[y].fill,';stroke-width:1"/>','<text x="',r[y].pol.x3,'" y="',r[y].pol.y3,'" fill="',r[y].fill,'" text-anchor="',r[y].pol.align,'">',c[y],"</text>");u.push('<circle cx="120" cy="120" r="15" fill="white" />','<circle cx="120" cy="120" r="9" stroke="#bbb" stroke-width="1" fill="white" />',"</g>"),void 0!==o.name?u.push('<text x="360" y="180" class="legend-title">Most busy on ',c[o.name],".</text>"):u.push('<text x="370" y="180" class="legend-title">Seems not busy.</text>'),$(".js-calendar-m-svg").html(u.join(""))},t.prototype.createBar=function(){function t(t){var e=$(".wrp-bar");switch(t){case"green":e.removeClass("gc-blue"),e.removeClass("gc-red");break;case"blue":e.addClass("gc-blue"),e.removeClass("gc-red");break;case"red":e.removeClass("gc-blue"),e.addClass("gc-red")}}var e=this.dataBase.day,a=this.dataBase.info,l=new Date(e[0].date),n=l.getDay(),s={lx:92-11*n,ly:100+6*n,lh:0},r=[],o=[],i=[];$(".wrp-bar").append($("<svg width='728' height='580' class='js-calendar-d-svg'></svg>")),o.push('<g class="day2"><polygon points="0,580 '),i.push('<g class="legend">','<rect class="legend-green" data-color="green" x="10" y="10" width="10" height="10" style="fill:#8cc665"/>','<rect class="legend-blue" data-color="blue" x="22" y="10" width="10" height="10" style="fill:#3399cc"/>','<rect class="legend-red" data-color="red" x="34" y="10" width="10" height="10" style="fill:#ff6666"/>',"</g>",'<g transform="translate(327, 65)">',"<text>Contributions in the last year</text>",'<text class="legend-number" x="225" y="10">',a.ciTotal,"</text>",'<text class="legend-muted" x="235" y="-4">Total</text>','<text x="235" y="10">',a.ciDate,"</text>","</g>",'<g transform="translate(327, 110)">','<text x="90">Busiest month</text>','<text class="legend-number" x="225" y="10">',a.bestMonth.count,"</text>",'<text class="legend-muted" x="235" y="-4">Commits</text>','<text x="235" y="10">',a.bestMonth.date,"</text>","</g>",'<g transform="translate(327, 155)">','<text x="100">Busiest day</text>','<text class="legend-number" x="225" y="10">',a.bestDay.count,"</text>",'<text class="legend-muted" x="235" y="-4">Commits</text>','<text x="235" y="10">',a.bestDay.date,"</text>","</g>",'<g transform="translate(-80, 330)">','<text x="90">Longest streak</text>','<text class="legend-number" x="225" y="10">',a.longestStreak,"</text>",'<text class="legend-muted" x="235" y="-4">Days</text>','<text x="235" y="10">',a.longestDate,"</text>","</g>",'<g transform="translate(-80, 375)">','<text x="90">Current streak</text>','<text class="legend-number" x="225" y="10">',a.currentStreak,"</text>",'<text class="legend-muted" x="235" y="-4">Days</text>','<text x="235" y="10">',a.currentDate,"</text>","</g>"),r=r.concat(i);for(var c=0,d=e.length;d>c;c++)0===n?(s.lx+=84,s.ly-=30):(s.lx-=12,s.ly+=6),s.lh=7*e[c].count,s.lh=0===s.lh?2:s.lh,s["class"]=parseInt((e[c].count+2)/3),s["class"]=s["class"]>4?"day4":"day"+s["class"],r.push('<g class="',s["class"],'">','<polygon points="',s.lx-10,",",s.ly+5," ",s.lx,",",s.ly+10," ",s.lx,",",s.ly+10-s.lh," ",s.lx-10,",",s.ly+5-s.lh,'" />','<polygon points="',s.lx,",",s.ly+10," ",s.lx+10,",",s.ly+5," ",s.lx+10,",",s.ly+5-s.lh," ",s.lx,",",s.ly+10-s.lh,'" />','<polygon points="',s.lx-10,",",s.ly+5-s.lh," ",s.lx,",",s.ly+10-s.lh," ",s.lx+10,",",s.ly+5-s.lh," ",s.lx,",",s.ly-s.lh,'" />',"</g>"),o.push(" ",2*c,",",580-s.lh),n=(n+1)%7;o.push(" ",2*(c-1),",",580,'" /></g>'),r=r.concat(o),$(".js-calendar-d-svg").html(r.join("")),chrome.storage.local.get("gcColorSetting",function(e){var a=e.gcColorSetting?e.gcColorSetting:"green";t(a)}),$("g.legend").on("click","rect",function(e){var a=$(this).data("color");t(a),chrome.storage.local.set({gcColorSetting:a})})},t}(),$(function(){var t,e;return e=document.querySelector("#contributions-calendar"),t=new GC(e)});